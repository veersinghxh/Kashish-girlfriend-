<!DOCTYPE html>
<html lang="hi">
  <body>
    <button id="startBtn">ЁЯОЩя╕П Start Speech</button>
    <div id="responseBox" style="margin-top:20px; font-size:18px; color:#333;"></div>

    <script>
      const speech = window.SpeechRecognition || window.webkitSpeechRecognition;
      const synth = window.speechSynthesis; // for Text-to-Speech

      if (!speech) {
        alert("SpeechRecognition not supported in this browser");
      } else {
        const r = new speech();
        r.continuous = false;
        r.interimResults = false;
        r.maxAlternatives = 1;

        const responseBox = document.getElementById("responseBox");

        // Start listening
        r.onstart = () => {
          console.log("ЁЯОд Listening...");
          responseBox.innerHTML = "ЁЯОд рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ...";
        };

        // When speech detected
        r.onresult = async function (event) {
          const transcript = event.results[0][0].transcript;
          console.log("You said:", transcript);
          responseBox.innerHTML = `<b>рдЖрдкрдиреЗ рдХрд╣рд╛:</b> ${transcript}<br><br>тП│ рд╕реЛрдЪ рд░рд╣рд╛ рд╣реВрдБ...`;

          // Get Gemini AI response
          const result = await genimi(transcript);

          // Show and speak Gemini response
          responseBox.innerHTML = `
            <b>рдЖрдкрдиреЗ рдХрд╣рд╛:</b> ${transcript}<br><br>
            <b>тЭдя╕П рдЧрд░реНрд▓рдлреНрд░реЗрдВрдб рдиреЗ рдХрд╣рд╛:</b> ${result}
          `;

          // Speak the response aloud in Hindi voice
          speakHindi(result);
        };

        r.onerror = (e) => {
          console.error("Error:", e.error);
          responseBox.innerHTML = `тЭМ Error: ${e.error}`;
        };

        document.getElementById("startBtn").onclick = () => r.start();
      }

      // Gemini API call function
      async function genimi(text) {
        const body = {
          system_instruction: {
            parts: [
              {
                text:
                  "You are an AI Girlfriend of Piyush Garg who likes coding. " +
                  "Respond in Hindi with emotion, using short friendly lines."
              }
            ]
          },
          contents: [{ parts: [{ text }] }]
        };

        const api_key = "AIzaSyBqvPoEO9WXB1_jZxP1lHdoz-uR0iPgz54"; // ЁЯФТ Replace with your Google API key

        try {
          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${api_key}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(body)
            }
          );

          const data = await response.json();
          return (
            data.candidates?.[0]?.content?.parts?.[0]?.text ||
            "тЪая╕П рдХреЛрдИ рдЬрд╡рд╛рдм рдирд╣реАрдВ рдорд┐рд▓рд╛ред"
          );
        } catch (error) {
          console.error("Gemini API Error:", error);
          return "тЭМ Gemini API рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдлреЗрд▓ рд╣реБрдЖред";
        }
      }

      // Function to speak text in Hindi voice
      function speakHindi(text) {
        if (!synth) {
          alert("Speech Synthesis not supported in this browser.");
          return;
        }

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "hi-IN"; // Hindi voice
        utterance.rate = 1;
        utterance.pitch = 1;

        // Try to pick a Hindi voice if available
        const voices = synth.getVoices();
        const hindiVoice = voices.find(v => v.lang === "hi-IN") || voices[0];
        if (hindiVoice) utterance.voice = hindiVoice;

        synth.speak(utterance);
      }

      // Preload available voices
      window.speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    </script>
  </body>
</html>    